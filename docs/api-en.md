# API interface description

`http://ip:port/mj `There is already api documentation, here is only for supplement

## 1. Data structure

### Task
| Field | Type | Example | Description |
|:-----:|:----:|:----|:----|
| id | string | 1689231405853400 / Task ID |
| action | string | IMAGINE | Task type: IMAGINE (drawing), UPGRADE (selected to enlarge), VARIATION (selected to transform), REROLL (re-execution), DESCRIBE (graphic text), BLEAND (picture mixing) |
| status | string | SUCCESS | Task status: NOT_START (not started), SUBMITTED (submitted for processing), IN_PROGRESS (in execution), FAILURE (FAILED), SUCCESS (successful) |
| prompt | string | cat cat | prompt word |
| promptEn | string | Cat | English prompt word |
|description | string | /imagine cat / task description |
| submitTime | number | 1689231405854 | Submission time |
| startTime | number | 1689231442755 | Start execution time |
| finishTime | number | 1689231544312 / End time |
| progress | string | 100% / Task progress |
| imageUrl | string | https://cdn.discordapp.com/attachments/xxx/xxx/xxxx.png | The url of the generated image, there is a value when it is successful or executed, it may be png or webp |
|failReason | string | [Invalid parameter] Invalid value | Cause of failure, there is a value when it fails |
| properties | object / {"finalPrompt": "Cat"} / Extended properties of the task, used internally by the system |


## 2. Task submission return
-code=1: Submitted successfully, result is the task ID
```json
{
"code": 1,
"description": "Success",
"result": "8498455807619990"
}
```
-code=21: The task already exists, it may occur when U
```json
{
"code": 21,
"description": "The task already exists",
"result": "0741798445574458",
"properties": {
"status": "SUCCESS",
"imageUrl": "https://xxxx"
}
}
```
-code=22: Submitted successfully, enter the queue and wait
```json
{
"code": 22,
"Description": "In the queue, there is still 1 task ahead",
"result": "0741798445574458",
"properties": {
"numberOfQueues": 1
}
}
```
-code=24: prompt contains sensitive words
```json
{
"code": 24,
"description": "May contain sensitive words",
"properties": {
"promptEn": "nude body",
"bannedWord": "nude"
}
}
```
-Other: Submit an error, description is the error description

## 3. `/mj/submit/simple-change' drawing change-simple
The interface functions the same as `/mj/submit/change` (drawing change), and the parameter transmission method is different. The interface receives content in the format of 'ID operation`, for example: 1320098173412546 U2

-Zoom in U1～U4
-Change V1～V4
-Re-execute R

## 4. `/mj/submit/describe' Graphic text
```json
{
// base64 string of picture
"base64": "data:image/png;base64,xxx"
}
```

After the subsequent task is completed, the finalPrompt in the properties is the prompt generated by the picture
```json
{
"id":"14001929738841620",
"action":"DESCRIBE",
"status": "SUCCESS",
"description":"/describe 14001929738841620.png",
"imageUrl":"https://cdn.discordapp.com/attachments/xxx/xxx/14001929738841620.png",
"properties": {
"finalPrompt": " 1️⃣ Cat --ar 5:4\n\n 2️⃣ Cat2 --ar 5:4\n\n 3️⃣ Cat3 --ar 5:4\n\n 4️⃣ Cat4 --ar 5:4"
}
// ...
}
```

## 5. Task change callback
When the task status changes or the progress changes, the interface of the business system will be called
-The interface address is the configured mj.notify-hook, support passing`notifyHook` when the task is submitted to change the callback address of this task
-When both are empty, no callback is triggered

POST application/json
```json
{
"id": "14001929738841620",
"action": "IMAGINE",
"status": "SUCCESS",
"prompt": "Cat cat",
"promptEn": "Cat",
"description": "/imagine cat cat",
"submitTime": 1689231405854,
"startTime": 1689231442755,
"finishTime": 1689231544312,
"progress": "100%",
"imageUrl": "https://cdn.discordapp.com/attachments/xxx/xxx/xxxx.png",
"failReason": null,
"properties": {
"finalPrompt": "Cat"
}
}
```